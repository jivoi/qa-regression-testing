SHELL=/bin/bash

test:
	gcc -m32 -o amd64_killer amd64_killer.c
	gcc -m64 -Wl,--dynamic-linker,/non-existent.so -o poison amd64_killer.c
	ulimit -c 1024 ; ./amd64_killer ./poison ; ret=$$? ; if [ $$ret -eq 139 ]; then echo correctly segfaulted instead of panic; exit 0; else echo did not segfault?; exit 1; fi

clean:
	rm -f amd64_killer poison core*
